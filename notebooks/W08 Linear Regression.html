<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>w08-linear-regression</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="W08 Linear Regression_files/libs/clipboard/clipboard.min.js"></script>
<script src="W08 Linear Regression_files/libs/quarto-html/quarto.js"></script>
<script src="W08 Linear Regression_files/libs/quarto-html/popper.min.js"></script>
<script src="W08 Linear Regression_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="W08 Linear Regression_files/libs/quarto-html/anchor.min.js"></script>
<link href="W08 Linear Regression_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="W08 Linear Regression_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="W08 Linear Regression_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="W08 Linear Regression_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="W08 Linear Regression_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<section id="regression" class="level1">
<h1>Regression</h1>
<section id="workshop-8-open-in-colab" class="level2">
<h2 class="anchored" data-anchor-id="workshop-8-open-in-colab"><em>Workshop 8</em> <a href="https://colab.research.google.com/github/oballinger/QM2/blob/main/notebooks/W08.%20Regression.ipynb"><img src="https://github.com/oballinger/QM2/blob/main/colab-badge.png?raw=1" class="img-fluid" alt="Open In Colab"></a></h2>
<section id="aims" class="level3">
<h3 class="anchored" data-anchor-id="aims">Aims:</h3>
<ul>
<li><p>Choosing appropriate summary statistics for varying distributions</p></li>
<li><p>Understanding:</p>
<ul>
<li>The nature of our dataset, including potential bias</li>
<li>How to generate summary statistics for our dataset</li>
<li>The distribution of different variables</li>
<li>The intuition behind the Central Limit Theorem</li>
</ul></li>
</ul>
</section>
</section>
<section id="getting-started" class="level2">
<h2 class="anchored" data-anchor-id="getting-started">Getting Started</h2>
<section id="first-things-first-bias" class="level3">
<h3 class="anchored" data-anchor-id="first-things-first-bias">First Things First: Bias</h3>
<p>Once we’ve acquired a dataset, the first step is <em>always</em> to develop an understanding of where the data has come from. For this dataset, use the following <a href="https://www.census.gov/programs-surveys/cps/technical-documentation/methodology.html">documentation page</a> to answer the questions below:</p>
<ol type="1">
<li>What is the population of interest?</li>
<li>What was the sampling strategy?</li>
<li>What are potential sources of selection bias?</li>
</ol>
<p>I’ll start by importing the libraries I need: matplotlib (for graphs), pandas (for data), numpy (for maths) and random (for generating random numbers):</p>
<div class="cell" data-execution_count="155">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#This tells python to draw the graphs "inline" - in the notebook</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline  </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> sqrt</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy.random <span class="im">import</span> seed</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy.random <span class="im">import</span> randn</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy <span class="im">import</span> mean</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> sem</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statistics </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pylab</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># make the plots (graphs) a little wider by default</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>pylab.rcParams[<span class="st">'figure.figsize'</span>] <span class="op">=</span> (<span class="fl">10.</span>, <span class="fl">8.</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-outputid="d585f549-6d26-4927-8a95-881a66072bdf" data-execution_count="5">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>mkdir data</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>mkdir data<span class="op">/</span>wk8</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>curl https:<span class="op">//</span>storage.googleapis.com<span class="op">/</span>qm2<span class="op">/</span>wk7<span class="op">/</span>cps.csv <span class="op">-</span>o data<span class="op">/</span>wk8<span class="op">/</span>cps.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>mkdir: data: File exists
mkdir: data/wk8: File exists
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 22.4M  100 22.4M    0     0  11.5M      0  0:00:01  0:00:01 --:--:-- 11.5M</code></pre>
</div>
</div>
<p>Now that I’ve imported the libraries I’m going to be using, I’m ready to import the data:</p>
<div class="cell" data-outputid="eaa86222-5f24-416a-c119-45cf3782f65a" data-execution_count="178">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.read_csv(<span class="st">'./data/wk7/cps.csv'</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="178">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>year</th>
      <th>state</th>
      <th>age</th>
      <th>sex</th>
      <th>race</th>
      <th>sch</th>
      <th>ind</th>
      <th>union</th>
      <th>incwage</th>
      <th>realhrwage</th>
      <th>occupation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1990</td>
      <td>36</td>
      <td>58</td>
      <td>1</td>
      <td>3</td>
      <td>12.0</td>
      <td>871</td>
      <td>0.0</td>
      <td>14200.0</td>
      <td>12.269874</td>
      <td>Office and Admin Support</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2009</td>
      <td>5</td>
      <td>28</td>
      <td>1</td>
      <td>1</td>
      <td>12.0</td>
      <td>8660</td>
      <td>1.0</td>
      <td>17680.0</td>
      <td>8.635149</td>
      <td>Office and Admin Support</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1990</td>
      <td>36</td>
      <td>37</td>
      <td>1</td>
      <td>1</td>
      <td>14.0</td>
      <td>380</td>
      <td>1.0</td>
      <td>28000.0</td>
      <td>21.169851</td>
      <td>.</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1990</td>
      <td>6</td>
      <td>34</td>
      <td>1</td>
      <td>1</td>
      <td>18.0</td>
      <td>740</td>
      <td>1.0</td>
      <td>27500.0</td>
      <td>20.447746</td>
      <td>Computer and Math Technicians</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1981</td>
      <td>51</td>
      <td>38</td>
      <td>1</td>
      <td>4</td>
      <td>13.0</td>
      <td>798</td>
      <td>NaN</td>
      <td>17000.0</td>
      <td>18.892282</td>
      <td>Managers</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Our dataframe has 10 columns:</p>
<ol type="1">
<li><em>year</em>: Survey year</li>
<li><em>age</em>: the person’s age</li>
<li><em>sex</em>: the person’s sex
<ul>
<li>1=male</li>
<li>2=female</li>
</ul></li>
<li><em>race</em>: the person’s race
<ul>
<li>White non hispanic=1</li>
<li>Black non hispanic=2</li>
<li>Hispanic=3</li>
<li>Other non hispanic=4)</li>
</ul></li>
<li><em>sch</em>: Educational attainment
<ul>
<li>None = 0,</li>
<li>Grades 1-12 = 1-12</li>
<li>Some University = 13,</li>
<li>Associate’s degree = 14,</li>
<li>BA = 16</li>
<li>Advanced Degree = 18</li>
</ul></li>
<li><em>union</em>: Union membership
<ul>
<li>N/A = 0,</li>
<li>No union coverage = 1,</li>
<li>Member of labor union=2,</li>
<li>Covered by union but not a member=3</li>
</ul></li>
<li><em>incwage</em>: Wage and salary income</li>
<li><em>realhrwage</em>: Real Hourly Wage</li>
<li><em>occupation</em>: Occupation</li>
<li><em>ind</em>: <a href="https://www.census.gov/naics/?58967?yearbck=2002">industry code</a></li>
</ol>
</section>
</section>
<section id="summary-statistics" class="level2">
<h2 class="anchored" data-anchor-id="summary-statistics">Summary Statistics</h2>
<p>After thinking about the origins of our dataset and loading it into python, the next step is to generate summary statistics. This is vital for us to better understand our data. Pandas has a useful function, <code>describe</code>, which will generate summary statistics for all numerical variables in our entire dataframe:</p>
<div class="cell" data-execution_count="145">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="145">
<pre><code>year            int64
state           int64
age             int64
sex             int64
race            int64
sch           float64
ind             int64
union         float64
incwage       float64
realhrwage    float64
occupation     object
dtype: object</code></pre>
</div>
</div>
<div class="cell" data-execution_count="179">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>reg_df<span class="op">=</span>df[df[<span class="st">'year'</span>]<span class="op">==</span><span class="dv">2013</span>]</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>reg_df[[<span class="st">'race'</span>,<span class="st">'union'</span>,<span class="st">'sex'</span>,<span class="st">'occupation'</span>]]<span class="op">=</span>reg_df[[<span class="st">'race'</span>,<span class="st">'union'</span>,<span class="st">'sex'</span>,<span class="st">'occupation'</span>]].astype(<span class="st">'category'</span>, )</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>reg_df[[<span class="st">'realhrwage'</span>,<span class="st">'sch'</span>,<span class="st">'age'</span>,<span class="st">'sex'</span>,<span class="st">'race'</span>,<span class="st">'union'</span>,<span class="st">'ind'</span>]].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/ollieballinger/.pyenv/versions/3.9.5/lib/python3.9/site-packages/pandas/core/frame.py:3191: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  self[k1] = value[k2]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="179">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>realhrwage</th>
      <th>sch</th>
      <th>age</th>
      <th>ind</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>53790.000000</td>
      <td>53790.000000</td>
      <td>53790.000000</td>
      <td>53790.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>24.381761</td>
      <td>13.925851</td>
      <td>42.909779</td>
      <td>6363.972188</td>
    </tr>
    <tr>
      <th>std</th>
      <td>151.904349</td>
      <td>2.738845</td>
      <td>10.557340</td>
      <td>2612.374440</td>
    </tr>
    <tr>
      <th>min</th>
      <td>2.005738</td>
      <td>0.000000</td>
      <td>25.000000</td>
      <td>170.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>12.170889</td>
      <td>12.000000</td>
      <td>34.000000</td>
      <td>4870.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>18.440742</td>
      <td>13.000000</td>
      <td>43.000000</td>
      <td>7380.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>28.122131</td>
      <td>16.000000</td>
      <td>51.000000</td>
      <td>8190.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>34760.796875</td>
      <td>18.000000</td>
      <td>64.000000</td>
      <td>9590.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Notice the max value for real hourly wage. Someone is making $34,760 per hour, must be nice (or, may be a data entry error). Either way, because regresisons are sensitive to this sort of outlier, we should remove it.</p>
<div class="cell" data-execution_count="193">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>sns.violinplot(reg_df[<span class="st">'realhrwage'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>KeyError: 0</code></pre>
</div>
</div>
<div class="cell" data-execution_count="187">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> filter_outliers(var):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    q1 <span class="op">=</span> var.quantile(<span class="fl">0.25</span>) <span class="co"># calculate the first quartile</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    q3 <span class="op">=</span> var.quantile(<span class="fl">0.75</span>) <span class="co"># calculate the third quartile</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    iqr <span class="op">=</span> q3 <span class="op">-</span> q1 <span class="co"># calculate the interquartile range</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    low <span class="op">=</span> q1 <span class="op">-</span> <span class="dv">3</span><span class="op">*</span>iqr <span class="co"># calculate the lower bound</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    high <span class="op">=</span> q3 <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>iqr <span class="co"># calculate the upper bound</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    filtered <span class="op">=</span> var[(var <span class="op">&gt;</span> low) <span class="op">&amp;</span> (var <span class="op">&lt;</span> high)] <span class="co"># filter  the values that are within the bounds</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    dropped_observations<span class="op">=</span> <span class="bu">len</span>(var)<span class="op">-</span><span class="bu">len</span>(filtered) <span class="co"># calculate the number of observations that were dropped</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Dropped </span><span class="sc">{}</span><span class="st"> observations'</span>.<span class="bu">format</span>(dropped_observations))</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>  filtered</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">#reg_df['realhrwage']=filter_outliers(reg_df['realhrwage'])</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>wage_filtered<span class="op">=</span>filter_outliers(reg_df[<span class="st">'realhrwage'</span>])</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>sns.violinplot(x<span class="op">=</span>wage_filtered)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>reg_df[<span class="st">'realhrwage'</span>]<span class="op">=</span>filter_outliers(reg_df[<span class="st">'realhrwage'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dropped 1070 observations</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="W08%20Linear%20Regression_files/figure-html/cell-8-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Dropped 1070 observations</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/6q/jt4x0r8n1rs0kbrrqrbj61fr0000gn/T/ipykernel_99061/2148039416.py:16: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  reg_df['realhrwage']=filter_outliers(reg_df['realhrwage'])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="200">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>sns.violinplot(data<span class="op">=</span>reg_df, x<span class="op">=</span><span class="st">"occupation"</span>, y<span class="op">=</span><span class="st">"realhrwage"</span>, hue<span class="op">=</span><span class="st">"sex"</span>,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>               split<span class="op">=</span><span class="va">True</span>, inner<span class="op">=</span><span class="st">"quart"</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sns.despine(left<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="W08%20Linear%20Regression_files/figure-html/cell-9-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="dummy-variables" class="level2">
<h2 class="anchored" data-anchor-id="dummy-variables">Dummy Variables</h2>
<div class="cell" data-execution_count="148">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>race_columns <span class="op">=</span> pd.get_dummies(reg_df[<span class="st">'race'</span>], prefix<span class="op">=</span><span class="st">'race'</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>race_columns.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="148">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>race_1</th>
      <th>race_2</th>
      <th>race_3</th>
      <th>race_4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>53790.000000</td>
      <td>53790.000000</td>
      <td>53790.000000</td>
      <td>53790.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.644395</td>
      <td>0.102975</td>
      <td>0.170125</td>
      <td>0.082506</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.478701</td>
      <td>0.303928</td>
      <td>0.375746</td>
      <td>0.275137</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="149">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>occupation_columns <span class="op">=</span> pd.get_dummies(reg_df[<span class="st">'occupation'</span>], prefix<span class="op">=</span><span class="st">'occ'</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>occupation_columns.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="149">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>occ_.</th>
      <th>occ_Business Operators</th>
      <th>occ_Community and Social Workers</th>
      <th>occ_Computer and Math Technicians</th>
      <th>occ_Consruction, Extraction, Installation</th>
      <th>occ_Farming, Fishing &amp; Forestry</th>
      <th>occ_Lawyers, Judges,Physicans and dentists</th>
      <th>occ_Managers</th>
      <th>occ_Office and Admin Support</th>
      <th>occ_Production</th>
      <th>occ_Protective Service adj_occupations</th>
      <th>occ_Transportation and materials moving</th>
      <th>occ_financial Operators</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>53790.000000</td>
      <td>53790.000000</td>
      <td>53790.000000</td>
      <td>53790.000000</td>
      <td>53790.000000</td>
      <td>53790.000000</td>
      <td>53790.000000</td>
      <td>53790.000000</td>
      <td>53790.000000</td>
      <td>53790.000000</td>
      <td>53790.000000</td>
      <td>53790.000000</td>
      <td>53790.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.403421</td>
      <td>0.025042</td>
      <td>0.019688</td>
      <td>0.033705</td>
      <td>0.082952</td>
      <td>0.006563</td>
      <td>0.013144</td>
      <td>0.107715</td>
      <td>0.134598</td>
      <td>0.064380</td>
      <td>0.024707</td>
      <td>0.059249</td>
      <td>0.024837</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.490588</td>
      <td>0.156254</td>
      <td>0.138926</td>
      <td>0.180471</td>
      <td>0.275813</td>
      <td>0.080744</td>
      <td>0.113891</td>
      <td>0.310023</td>
      <td>0.341296</td>
      <td>0.245431</td>
      <td>0.155233</td>
      <td>0.236092</td>
      <td>0.155631</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>plt.hist(np.log(df[<span class="st">'realhrwage'</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="84">
<pre><code>(array([  167.,   393.,  1667.,  5295., 10451., 13213., 11335.,  6772.,
         3019.,   893.]),
 array([0.69601208, 1.08683056, 1.47764904, 1.86846752, 2.25928601,
        2.65010449, 3.04092297, 3.43174145, 3.82255993, 4.21337841,
        4.60419689]),
 &lt;BarContainer object of 10 artists&gt;)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="W08%20Linear%20Regression_files/figure-html/cell-12-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ttest(data1, data2, alpha):</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate means</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">#data1=np.log2(data1)</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#data2=np.log2(data2)</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    plt.hist(data1)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    plt.hist(data2)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    mean1, mean2 <span class="op">=</span> mean(data1), mean(data2)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate standard errors</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    sd1, sd2 <span class="op">=</span> statistics.stdev(data1), statistics.stdev(data2)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    se1, se2 <span class="op">=</span> sem(data1), sem(data2)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># standard error on the difference between the samples</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    sed <span class="op">=</span> sqrt(se1<span class="op">**</span><span class="fl">2.0</span> <span class="op">+</span> se2<span class="op">**</span><span class="fl">2.0</span>)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate the t statistic</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    t_stat <span class="op">=</span> (mean1 <span class="op">-</span> mean2) <span class="op">/</span> sed</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># degrees of freedom</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> <span class="bu">len</span>(data1) <span class="op">+</span> <span class="bu">len</span>(data2) <span class="op">-</span> <span class="dv">2</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate the critical value</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    cv <span class="op">=</span> t.ppf(<span class="fl">1.0</span> <span class="op">-</span> alpha, df)</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate the p-value</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> (<span class="fl">1.0</span> <span class="op">-</span> t.cdf(<span class="bu">abs</span>(t_stat), df)) <span class="op">*</span> <span class="fl">2.0</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># return everything</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(mean1,sd1, mean2,sd2)</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> t_stat, df, cv, p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-outputid="dbaccbc3-e7fc-462f-eda6-5c78029bb630" data-execution_count="127">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>y<span class="op">=</span>np.log(df[<span class="st">'realhrwage'</span>])</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>x<span class="op">=</span>sm.add_constant(df[[<span class="st">'sch'</span>,<span class="st">'race_2'</span>,<span class="st">'race_3'</span>,<span class="st">'race_4'</span>,<span class="st">'sex'</span>,<span class="st">'age'</span>,<span class="st">'union'</span>,<span class="st">'ind'</span>]], prepend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">#x=df[['incwage']]</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>x_b<span class="op">=</span>sm.add_constant(x, prepend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>mod <span class="op">=</span> sm.OLS(y, x_b, missing<span class="op">=</span><span class="st">'drop'</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>res<span class="op">=</span>mod.fit()</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(res.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:             realhrwage   R-squared:                       0.264
Model:                            OLS   Adj. R-squared:                  0.264
Method:                 Least Squares   F-statistic:                 1.356e+04
Date:                Tue, 22 Nov 2022   Prob (F-statistic):               0.00
Time:                        15:50:39   Log-Likelihood:            -2.4247e+05
No. Observations:              301908   AIC:                         4.850e+05
Df Residuals:                  301899   BIC:                         4.851e+05
Df Model:                           8                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
sch            0.0980      0.000    253.458      0.000       0.097       0.099
race_2        -0.1258      0.003    -37.316      0.000      -0.132      -0.119
race_3        -0.0821      0.003    -27.587      0.000      -0.088      -0.076
race_4        -0.0371      0.004     -9.281      0.000      -0.045      -0.029
sex           -0.2904      0.002   -144.894      0.000      -0.294      -0.286
age            0.0083   9.62e-05     86.004      0.000       0.008       0.008
union          0.0052      0.002      2.615      0.009       0.001       0.009
ind         1.778e-06   3.05e-07      5.830      0.000    1.18e-06    2.38e-06
const          1.6647      0.007    224.599      0.000       1.650       1.679
==============================================================================
Omnibus:                    17049.066   Durbin-Watson:                   2.002
Prob(Omnibus):                  0.000   Jarque-Bera (JB):            69453.269
Skew:                           0.099   Prob(JB):                         0.00
Kurtosis:                       5.341   Cond. No.                     4.49e+04
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 4.49e+04. This might indicate that there are
strong multicollinearity or other numerical problems.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="214">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>sns.lmplot(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>reg_df, x<span class="op">=</span><span class="st">"sch"</span>, y<span class="op">=</span><span class="st">"realhrwage"</span>, hue<span class="op">=</span><span class="st">'race'</span>, row<span class="op">=</span><span class="st">'sex'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="214">
<pre><code>&lt;seaborn.axisgrid.FacetGrid at 0x184e21130&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="W08%20Linear%20Regression_files/figure-html/cell-15-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>pred_ols <span class="op">=</span> res.get_prediction()</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>iv_l <span class="op">=</span> pred_ols.summary_frame()[<span class="st">"obs_ci_lower"</span>]</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>iv_u <span class="op">=</span> pred_ols.summary_frame()[<span class="st">"obs_ci_upper"</span>]</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>ax.plot(x, y, <span class="st">"o"</span>, label<span class="op">=</span><span class="st">"data"</span>, alpha<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>ax.plot(x, res.fittedvalues, <span class="st">"r--."</span>, label<span class="op">=</span><span class="st">"OLS"</span>)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>ax.plot(x, iv_u, <span class="st">"r--"</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>ax.plot(x, iv_l, <span class="st">"r--"</span>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>ax.legend(loc<span class="op">=</span><span class="st">"best"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="90">
<pre><code>&lt;matplotlib.legend.Legend at 0x17ad10e80&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="W08%20Linear%20Regression_files/figure-html/cell-16-output-2.png" class="img-fluid"></p>
</div>
</div>
<p><code>describe</code> returns a dataframe with the same columns as the source dataframe. For numeric data, the result’s index will include count, mean, std, min, max as well as lower, 50 and upper percentiles. By default the lower percentile is 25 and the upper percentile is 75. The 50 percentile is the same as the median. “incwage” is the annual income variable. Because values are generally in the tens of thousands, Python displays this using scientific notation (e.g.&nbsp;3.442870e+05). This is pretty ugly, so let’s create a new variable called “income” which divides that number by 1000 to make it more manageable:</p>
<div class="cell" data-outputid="9916c0fc-2ef4-4a91-a59d-e47f02969b64" data-execution_count="94">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'income'</span>]<span class="op">=</span>df[<span class="st">'incwage'</span>]<span class="op">/</span><span class="dv">1000</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'income'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>20        57.0
32        62.0
34        45.0
36        28.0
37        42.5
          ... 
344244    14.5
344269    23.0
344278    45.0
344281    23.0
344286    15.0
Name: income, Length: 53205, dtype: float64</code></pre>
</div>
</div>
<section id="exercise" class="level3">
<h3 class="anchored" data-anchor-id="exercise">Exercise</h3>
<p>Given these summary statistics, answer the following questions:</p>
<ol type="1">
<li>what is the median hourly wage?</li>
<li>what is the average age?</li>
<li>are there more men or women?</li>
<li>intepret the mean of the “race” column.</li>
</ol>
<p>The answer to the last question should provoke some futher thought; the race column is categorical, but because it contains numbers it’s being treated as numerical. The mean of a categorical variable is meaningless; For object data (e.g.&nbsp;categories, strings or timestamps), the result’s index will include count, unique, top, and freq. The top is the most common value. The freq is the most common value’s frequency. Timestamps also include the first and last items.</p>
<p>Let’s convert the race column from a numerical variable into a categorical one, and try <code>describe</code> once again:</p>
<div class="cell" data-outputid="7fa93b7f-5807-435f-c0be-e23ba21364f9" data-execution_count="6">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>df.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>year            int64
state           int64
age             int64
sex             int64
race            int64
sch           float64
ind             int64
union         float64
incwage       float64
realhrwage    float64
occupation     object
income        float64
dtype: object</code></pre>
</div>
</div>
<div class="cell" data-outputid="9643b377-f49d-4376-a008-06a9432db860" data-execution_count="96">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">'race'</span>,<span class="st">'ind'</span>,<span class="st">'union'</span>,<span class="st">'occupation'</span>]]<span class="op">=</span>df[[<span class="st">'race'</span>,<span class="st">'ind'</span>,<span class="st">'union'</span>,<span class="st">'occupation'</span>]].astype(<span class="st">'category'</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>df.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="96">
<pre><code>year             int64
state            int64
age              int64
sex              int64
race          category
sch            float64
ind           category
union         category
incwage        float64
realhrwage     float64
occupation    category
const          float64
income         float64
dtype: object</code></pre>
</div>
</div>
<p>what other variables are categorical? Convert them to categorical and describe. What is the most common occupation in this dataset?</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the variables to categorical and describe</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These statistics are useful, but suppose we want detailed counts of the number of individuals in each category; For this, we can use the <code>groupby</code> function, with the <code>.size()</code> operator which simply counts the number of rows in each category.</p>
<div class="cell" data-outputid="9f1abc21-9bf0-47d7-894f-fcacb8765828" data-execution_count="9">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>occupations<span class="op">=</span> df.groupby(<span class="st">'occupation'</span>).size()</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>occupations.sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>occupation
.                                         132708
Office and Admin Support                   50635
Managers                                   35696
Consruction, Extraction, Installation      30579
Production                                 29732
Transportation and materials moving        21277
Computer and Math Technicians               8602
Protective Service adj_occupations          7809
financial Operators                         7702
Business Operators                          7327
Community and Social Workers                6025
Lawyers, Judges,Physicans and dentists      3835
Farming, Fishing &amp; Forestry                 2360
dtype: int64</code></pre>
</div>
</div>
<p>What is the most common profession?</p>
</section>
</section>
</section>
<section id="distributions" class="level1">
<h1>Distributions</h1>
<p>Now that we’ve cleaned our data up, let’s have a closer look at the <em>distribution</em> of our data. The best way to do this is using a histogram, which takes one variable and divides its values into a number of bins shown on the X axis, and then counts the number of observations in each of those bins on the Y axis. Let’s start by looking at the distribution of the <code>income</code> variable:</p>
<div class="cell" data-outputid="a8c0171e-bfc2-49cf-ad50-019a302f8ff9" data-execution_count="10">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>df[df[<span class="st">'year'</span>]<span class="op">==</span><span class="dv">2013</span>] <span class="co"># filter the dataframe to only contain 2013 data</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>plt.hist(df[<span class="st">'income'</span>]) <span class="co"># plot a histogram of the income variable</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>plt.show() <span class="co"># show the plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="W08%20Linear%20Regression_files/figure-html/cell-22-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>This is a pretty ugly histogram, and it’s not telling us very much useful information. It shows that the vast majority of people make between 0 and $100,000 per year, and a few make over 200k. A small number make over $1 million per year, so the plot is being extended to accomodate these outliers. Let’s try fixing the histogram up a bit.</p>
<div class="cell" data-outputid="dc491133-f7ac-424b-f427-28ed1514e295" data-execution_count="11">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>plt.hist(df[<span class="st">'income'</span>], bins<span class="op">=</span><span class="dv">100</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>, density<span class="op">=</span><span class="va">True</span>) </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co"># i've increased the number of bins to 100 to make the plot smoother,</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co"># added the density=True argument to make the y-axis a probability density instead of a count,</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># and the edgecolor='white' argument to add some space between the bars, making the plot easier to read</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Income ($, thousands)'</span>) <span class="co"># add a label to the x axis</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"U.S. Income Distributon, 2013"</span>) <span class="co"># add a title to the plot</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>plt.show() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="W08%20Linear%20Regression_files/figure-html/cell-23-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>That’s better. We can now see more variation in how much people earn within the $0-200,000 range since we increased the number of bins in the histogram. It could still be improved, though. The outliers making over $ 1 million are creating lots of dead space in this plot. We can defensibly omit them from the plot, as long as we acknowledge that we’ve done this somewhere in our analysis.</p>
<p>Let’s also plot the mean and median of our distribution.</p>
<div class="cell" data-outputid="ec9bc59c-b61b-4c2b-c3fc-35a45f3bf7db" data-execution_count="12">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>inc_summary<span class="op">=</span>df[<span class="st">'income'</span>].describe() <span class="co"># get summary statistics for the income variable using the describe() method, and store them in a variable called inc_summary</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(inc_summary[[<span class="st">'mean'</span>,<span class="st">'50%'</span>,<span class="st">'std'</span>]]) <span class="co"># print the mean, median and standard deviation</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>plt.hist(df[<span class="st">'income'</span>], bins<span class="op">=</span><span class="dv">100</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>, density<span class="op">=</span><span class="va">True</span>) <span class="co"># plot the histogram again</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>plt.axvline(inc_summary[<span class="st">'mean'</span>], color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="dv">1</span>,label<span class="op">=</span><span class="st">'Mean'</span>) <span class="co"># get the mean from the inc_summary variable and plot a vertical line in red at that point</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>plt.axvline(inc_summary[<span class="st">'50%'</span>], color<span class="op">=</span><span class="st">'black'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, label<span class="op">=</span><span class="st">'Median'</span>) <span class="co"># do the same for the median, but plot it in black</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Income ($, thousands'</span>)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"U.S. Income Distributon, 2013"</span>)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="dv">0</span>,<span class="dv">250</span>) <span class="co"># set the x-axis limits to 0 to 250-- this will get rid of the outliers on the right side of the plot</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>mean    51.821863
50%     40.000000
std     60.163449
Name: income, dtype: float64</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="W08%20Linear%20Regression_files/figure-html/cell-24-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>This histogram is far more informative– use the questions in the exercise below to guide your interpretation of this plot.</p>
<section id="exercise-1" class="level3">
<h3 class="anchored" data-anchor-id="exercise-1">Exercise</h3>
<ol type="1">
<li>What is the (approximate) mean of this distribution?</li>
<li>What is the median?</li>
<li>Keeping in mind that we’ve excluded some extreme values, why might the mean be larger than the median? Intepret this qualitatively in reference to income inequality.</li>
<li>There are slight bumps in density at $100,000, $150,000, $200,000, and $250,000. Why might this be?</li>
</ol>
</section>
<section id="functions" class="level2">
<h2 class="anchored" data-anchor-id="functions">Functions</h2>
<p>Now we’ve got a pretty good sense of what’s going on with the income variable. But suppose we want to do this for another variable. We could just copy and paste the code above, switch around the variable in question, and edit the labels. But there’s a far more efficient way of doing things. In Python and most programming languages, you can write your own <strong>function</strong>.</p>
<p>A function is a block of code that you can call on to do a specific task. You can write your own functions, or you can use functions that other people have written. Functions are useful because they allow you to write code once, and then call on it whenever you need it. This is much more efficient than writing the same code over and over again. You can define a function by using the <code>def</code> keyword. For example, we can define a function called <code>variable_stats</code> that will calculate the mean, median, and standard deviation of the variable tha you specify.</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> variable_stats(variable): <span class="co"># define a function called variable_stats that takes a variable as an argument</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    mean <span class="op">=</span> variable.mean() <span class="co"># calculate the mean of the variable</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    median <span class="op">=</span> variable.median() <span class="co"># calculate the median of the variable</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    std <span class="op">=</span> variable.std() <span class="co"># calculate the standard deviation of the variable</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Mean: "</span> <span class="op">+</span> <span class="bu">str</span>(mean)) <span class="co"># print the mean</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Median: "</span> <span class="op">+</span> <span class="bu">str</span>(median)) <span class="co"># print the median</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Standard deviation: "</span> <span class="op">+</span> <span class="bu">str</span>(std)) <span class="co"># print the standard deviation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We can then call on this function whenever we want to calculate these statistics. </span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>variable_stats(df[<span class="st">'income'</span>]) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean: 51.821862558096306
Median: 40.0
Standard deviation: 60.163449180529874</code></pre>
</div>
</div>
<p>Now, to calculate the same values for the age variable, we can simply change which variable we feed the function:</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>variable_stats(df[<span class="st">'age'</span>]) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean: 42.909778769287975
Median: 43.0
Standard deviation: 10.557339619953297</code></pre>
</div>
</div>
<p>We can write a more complex function to deal with plotting new histograms for different variables, since most of the code we need to plot a histogram won’t change from one variable to the next. A few things will change– the variable that we’re plotting, the title of the graph, and the labels on the x and y axes, and perhaps the number of bins. We can write a function called <code>plot_histogram</code> that takes these four things as arguments, and then plots a histogram. Then, we can call on this function whenever we want to plot a histogram of a new variable. Below is the same code we used to plot the histogram of income, but this time we’ve written it as a function called <code>plot_histogram</code> and substituted the variable name <code>income</code> for the argument <code>variable</code>.</p>
<div class="cell" data-outputid="b4159584-f642-4ef8-9a8a-818d3edef12e" data-execution_count="16">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_histogram(variable, bin_number, xlab, title): <span class="co"># define a function called plot_histogram that takes a variable, number of bins, x-axis label, and title as arguments</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    summary<span class="op">=</span>variable.describe()     </span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    plt.hist(variable, bins<span class="op">=</span>bin_number,edgecolor<span class="op">=</span><span class="st">'white'</span>, density<span class="op">=</span><span class="va">True</span>) <span class="co"># plot the histogram. Notice i've changed "bins=100" to "bins=bin_number" so that the number of bins can be specified when the function is called</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    plt.axvline(summary[<span class="st">'mean'</span>], color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="dv">1</span>,label<span class="op">=</span><span class="st">'Mean '</span><span class="op">+</span><span class="bu">str</span>(<span class="bu">round</span>(summary[<span class="st">'mean'</span>],<span class="dv">2</span>)))</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    plt.axvline(summary[<span class="st">'50%'</span>], color<span class="op">=</span><span class="st">'black'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, label<span class="op">=</span><span class="st">'Median '</span><span class="op">+</span><span class="bu">str</span>(<span class="bu">round</span>(summary[<span class="st">'50%'</span>],<span class="dv">2</span>)))</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(xlab) <span class="co"># i've changed the x-axis label to "xlab" so that it can be specified when the function is called</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    plt.title(title) <span class="co"># similarly, we can now specify the title when calling the function</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can just call the function with the variable we want to plot, the number of bins, the x-axis label, and the title using one line of code. Let’s recreate the histogram of income from above, but this time using the function we just defined:</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>plot_histogram(variable <span class="op">=</span> df[<span class="st">'income'</span>], bin_number <span class="op">=</span> <span class="dv">100</span>, xlab <span class="op">=</span> <span class="st">'Income ($, 000)'</span>, title <span class="op">=</span> <span class="st">'U.S. Income Distribution, 2013'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="W08%20Linear%20Regression_files/figure-html/cell-29-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>If we want to produce lots of similar plots, this really helps us cut down on repetition.</p>
<section id="exercise-2" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2">Exercise</h3>
<ol type="1">
<li>Plot the histogram of the ‘age’ variable with 80 bins, label the x-axis “Age”, and add title of ‘U.S. Age Distribution, 2013’.</li>
<li>Plot the distribution of schooling years.
<ul>
<li>Find an appropriate number of bins</li>
<li>Label it clearly</li>
<li>Interpret salient trends</li>
</ul></li>
</ol>
</section>
</section>
<section id="the-central-limit-theorem" class="level2">
<h2 class="anchored" data-anchor-id="the-central-limit-theorem">The Central Limit Theorem</h2>
<p>But as we learned in class, the Central Limit Theorem states that the <strong>distribution of the mean of a sample of observations will be approximately normal, regardless of the distribution of the original observations</strong>. So, if we take a <strong>large enough sample</strong> of observations from each of these variables, and calculate the mean of each sample, we should get a normal distribution. This is important because the normal distribution behaves in a very predictable way.</p>
<p>The code below creates a “standard normal” distribution with a mean of 0 and a standard deviation of 1:</p>
<div class="cell" data-outputid="c9cde8cf-1864-4add-f2ff-457acd7f9828" data-execution_count="18">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>mu, se<span class="op">=</span> <span class="dv">0</span>, <span class="dv">1</span> <span class="co"># create two variables, a mean "mu" equal to zero, and standard deviation "se" equal to 1</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(mu <span class="op">-</span> <span class="dv">3</span><span class="op">*</span>se, mu <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>se, <span class="dv">100</span>) <span class="co"># create a range of values from -3 to 3 standard deviations</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>plt.plot(x, norm.pdf(x, mu, se)) <span class="co"># plot the normal distribution</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>plt.axvline(mu, color<span class="op">=</span><span class="st">'black'</span>, linestyle<span class="op">=</span><span class="st">'solid'</span>, linewidth<span class="op">=</span><span class="dv">1</span>,label<span class="op">=</span><span class="st">'µ'</span>)  <span class="co"># plot a vertical line at the mean</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>plt.axvline(mu<span class="op">-</span>se<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'black'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>,label<span class="op">=</span><span class="st">'µ ± 2σ'</span>) <span class="co"># plot a vertical line at the mean plus 2 standard deviations</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>plt.axvline(mu<span class="op">+</span>se<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'black'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>)  <span class="co"># plot a vertical line at the mean minus 2 standard deviations</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="W08%20Linear%20Regression_files/figure-html/cell-32-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>for a distribution with this shape,</p>
<pre><code>* 68% of the values will be within 1 standard deviation of the mean
* 95% of the values will be within 2 standard deviations of the mean
* 99.7% of the values will be within 3 standard deviations of the mean</code></pre>
<p>so in the plot above, if I took a random value from the distribution, there’s a 95% chance that it would be between -2 and 2 (within the dotted lines), and a 99.7% chance that it would be between -3 and 3.</p>
<p>It’s crucial to note, however, that this applies to the mean of a sample, not individual observations. For example, this doesnt mean that there is a 95% chance that an individual taken at random will have an income that is within 2 standard deviations of the mean ($51k). It means that if we take a sample of 100 observations, there is a 95% chance that the <strong>mean of that sample</strong> will be within 2 standard deviations of the mean ($51k).</p>
<section id="sampling" class="level3">
<h3 class="anchored" data-anchor-id="sampling">Sampling</h3>
<p>To illustrate how this works, for the rest of this workshop we’re going to pretend that the dataframe contains the entire adult <strong>population</strong> of the United States (of course, it is actually a sample but just pretend). The mean of this distribution will thus be the <strong>population mean</strong>; for the income variable, this is $51k.</p>
<p>We can use the <code>sample</code> function to take a random sample of observations from a distribution. We’ll take a sample of 5 observations from the income variable and use the <code>mean</code> function to calculate the mean of this sample.</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>income_sample <span class="op">=</span> df[<span class="st">'income'</span>].sample(<span class="dv">5</span>) <span class="co"># take a random sample of 10 observations from the income variable</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>income_sample_mean<span class="op">=</span>income_sample.mean() <span class="co"># calculate the mean of the sample</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Mean: "</span> <span class="op">+</span> <span class="bu">str</span>(income_sample_mean)) <span class="co"># print the sample mean</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean: 37.0</code></pre>
</div>
</div>
</section>
<section id="exercise-3" class="level3">
<h3 class="anchored" data-anchor-id="exercise-3">Exercise</h3>
<ol type="1">
<li>Run the code cell above 10 times and make note of the mean. What is the farthest the sample mean deviates from the “population” mean of $51k?</li>
<li>Increase the sample size from 5 to 100 and run the cell 10 more times. Now, what is the farthest the sample mean deviates from the population mean?</li>
<li>Increase the sample size to 1000. What do you notice about the sample means as we increase the sample size?</li>
</ol>
<p>Hopefully, you will have noticed that as the sample size increases, the sample means tend to be closer to the population mean. But clicking that cell is hard work. Let’s create a loop that will run that block of code 10000 times, save the sample means in a list, and plot the distribution of sample means as a histogram. Once again, we’ll start by only drawing samples of 10 observations:</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create an empty list to store sample means</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>sample_means<span class="op">=</span>[]</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co"># loop 10,000 times.</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">10000</span>):</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    sample<span class="op">=</span> df[<span class="st">'income'</span>].sample(<span class="dv">10</span>, replace<span class="op">=</span><span class="va">True</span>) <span class="co"># draw a sample of 10 observations from the income variable, with replacement</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    sample_mean<span class="op">=</span>sample.mean() <span class="co"># calculate the mean of the sample</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    sample_means.append(sample_mean) <span class="co"># append the sample mean to the list of sample means</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>plt.hist(sample_means, bins<span class="op">=</span><span class="dv">100</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>, density<span class="op">=</span><span class="va">True</span>) <span class="co"># plot a histogram of the sample means</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of Sample Means (n=1000)'</span>)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="W08%20Linear%20Regression_files/figure-html/cell-34-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="exercise-4" class="level3">
<h3 class="anchored" data-anchor-id="exercise-4">Exercise</h3>
<pre><code>1. Edit the code block above so that instead of drawing samples of 10 observations, it draws samples of 1000 observations
2. What happens to the distribution?</code></pre>
<p>When we draw 10,000 samples of 1000 observations each, the distribution of sample means looks a lot more normally distributed than the underlying distribution of income itself, which is skewed to the right. To show how normally distributed it is, let’s overlay the normal distribution line we plotted earlier and fit it to the distribution of sample means. We’ll start off by making the same histogram of sample means, but add a line plot of the normal distribution and some droplines at ± 2 standard deviations.</p>
<p>Because we may want to do this for several different variables, let’s once again package our code as a function in which we can swap around a couple bits. In this case, we may want to swap around the variable we’re plotting, the label on the x-axis, and the size of the samples we’re drawing. So we’ll create a function called <code>plot_sample_means</code> that takes these three things as arguments (<code>var</code>, <code>xlab</code>, and <code>sample_size</code>).</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_sample_means(var, xlab, sample_size): <span class="co"># define a function called plot_sample_means that takes a variable, x-axis label, and sample size as arguments</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">#create an empty list to store sample means</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    sample_means<span class="op">=</span>[]</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># loop 10,000 times.</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">10000</span>):</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># for each iteration, draw a sample of the size specified by the "sample_size" parameter</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>        sample<span class="op">=</span>var.sample(sample_size, replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># calculate the mean, and append it to the list of sample means. </span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>        sample_mean<span class="op">=</span>sample.mean()</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>        sample_means.append(sample_mean)</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># now, plot a histogram </span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>    plt.hist(sample_means, bins<span class="op">=</span><span class="bu">int</span>(<span class="dv">30</span>), edgecolor<span class="op">=</span><span class="st">'white'</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fit a normal distribution to the data </span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>    mu, se <span class="op">=</span> norm.fit(sample_means)</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>    xmin, xmax <span class="op">=</span> plt.xlim()</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> np.linspace(xmin, xmax, <span class="dv">100</span>)</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> norm.pdf(x, mu, se) </span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>    plt.plot(x, p, <span class="st">'k'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate the difference between the mean of the sample means </span></span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>    diff<span class="op">=</span><span class="bu">abs</span>(mu<span class="op">-</span>var.mean())</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add droplines, labels, title, legend, and limit the x-axis range to 3 standard deviations from the mean on either side.</span></span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>    plt.axvline(mu, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="dv">1</span>,label<span class="op">=</span><span class="st">'µx̄='</span><span class="op">+</span><span class="bu">str</span>(<span class="bu">round</span>(mu, <span class="dv">3</span>)))</span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>    plt.axvline(mu<span class="op">-</span>se<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'black'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>,label<span class="op">=</span><span class="st">'µ ± 2σ'</span>)</span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a>    plt.axvline(mu<span class="op">+</span>se<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'black'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(xlab)    </span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Distribution of Sample Means (n=</span><span class="sc">{}</span><span class="st">)'</span>.<span class="bu">format</span>(sample_size))</span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a>    plt.xlim(mu<span class="op">-</span>se<span class="op">*</span><span class="dv">3</span>, mu<span class="op">+</span>se<span class="op">*</span><span class="dv">3</span>)</span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a>    plt.show()  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>plot_sample_means(df[<span class="st">'income'</span>], xlab<span class="op">=</span><span class="st">'Income, ($, 000)'</span>, sample_size<span class="op">=</span><span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="W08%20Linear%20Regression_files/figure-html/cell-36-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>We can see that the distribution of sample means (for samples of 1000 people) very closely approximates the normal distribution. The addition of droplines at ±2σ tells us that <strong>if we take a random sample of 1000 people, there is a 95% chance that the mean of this sample will fall between ~$48k and ~$56k</strong>.</p>
<p>Why is this important? let’s see what happens when we filter the sample based on peoples’ attributes. The code below creates two dataframes: one called <code>men</code> which only contains male respondents, and one called <code>women</code> which only contains female respondents. Then, we run the <code>plot_sample_means()</code> function on each of these dataframes.</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>men<span class="op">=</span>df[df[<span class="st">'sex'</span>]<span class="op">==</span><span class="dv">1</span>][<span class="st">'income'</span>] <span class="co"># create a new dataframe containing only income values for men</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>women<span class="op">=</span>df[df[<span class="st">'sex'</span>]<span class="op">==</span><span class="dv">2</span>][<span class="st">'income'</span>] <span class="co"># create a new dataframe containing only income values for women</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>plot_sample_means(men, xlab<span class="op">=</span><span class="st">'Income, ($, 000)'</span>, sample_size<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>plot_sample_means(women, xlab<span class="op">=</span><span class="st">'Income, ($, 000)'</span>, sample_size<span class="op">=</span><span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="W08%20Linear%20Regression_files/figure-html/cell-37-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="W08%20Linear%20Regression_files/figure-html/cell-37-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="exercise-5" class="level3">
<h3 class="anchored" data-anchor-id="exercise-5">Exercise</h3>
<pre><code>1. These two histograms may look the same, but look closely at the values. 
2. The population mean income for women is around $42k. Based on the histogram of sample means taken from only men, 
    * What is the likelihood of observing a sample mean of $42k among men due to random chance?
3. Interpret this finding qualitatively.</code></pre>
<p>The plot of incomes for men and women show very different distributions, but they look quite similar. To make this more readable, let’s define one last function that can take two or more groups and plot the distribution of their sample means on the same plot:</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> two_hist(groups,group_labs,xlab, title): <span class="co"># define a function called two_hist that takes a list of groups, a list of group labels, an x-axis label, and a title as arguments</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">6</span>)) <span class="co"># set the figure size</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>        it<span class="op">=-</span><span class="dv">1</span> <span class="co"># create a counter variable called "it" and set it equal to -1</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> var <span class="kw">in</span> groups: <span class="co"># loop through each group in the list of groups</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>            it<span class="op">+=</span><span class="dv">1</span> <span class="co"># increase the iterator by 1</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>            sample_size<span class="op">=</span><span class="dv">1000</span> <span class="co"># set the sample size equal to 1000</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>            sample_means<span class="op">=</span>[] <span class="co"># create an empty list to store sample means</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>            iterations<span class="op">=</span><span class="dv">10000</span> <span class="co"># set the number of iterations equal to 10,000</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,iterations): <span class="co"># loop through the number of iterations</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>                sample<span class="op">=</span>var.sample(sample_size, replace<span class="op">=</span><span class="va">True</span>) <span class="co"># draw a sample of the size specified by the "sample_size" parameter</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>                sample_mean<span class="op">=</span>sample.mean() <span class="co"># calculate the mean of the sample</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>                sample_means.append(sample_mean) <span class="co"># append the sample mean to the list of sample means</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>            plt.hist(sample_means, bins<span class="op">=</span><span class="bu">int</span>(iterations<span class="op">/</span><span class="dv">300</span>),edgecolor<span class="op">=</span><span class="st">'white'</span>,density<span class="op">=</span><span class="va">True</span>, label<span class="op">=</span>group_labs[it])  <span class="co"># plot a histogram of the sample means</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>            mu, std <span class="op">=</span> norm.fit(sample_means) <span class="co"># fit a normal distribution to the data</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>            xmin, xmax <span class="op">=</span> plt.xlim() <span class="co"># set the x-axis limits</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>            x <span class="op">=</span> np.linspace(xmin, xmax, <span class="dv">100</span>) <span class="co"># create a range of values from the minimum to the maximum x-axis value</span></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>            p <span class="op">=</span> norm.pdf(x, mu, std) <span class="co"># calculate the probability density function for the normal distribution</span></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>            plt.plot(x, p, <span class="st">'k'</span>, linewidth<span class="op">=</span><span class="dv">2</span>) <span class="co"># plot the normal distribution</span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>            plt.xlabel(xlab) <span class="co"># add an x-axis label</span></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>            plt.title(title) <span class="co"># add a title</span></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>            plt.axvline(var.mean(), color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'solid'</span>, linewidth<span class="op">=</span><span class="dv">2</span>) <span class="co"># add a vertical line at the mean of the variable</span></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>            plt.legend() <span class="co"># add a legend</span></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>        plt.show()  <span class="co"># show the plot </span></span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>        plt.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>two_hist([men,women],[<span class="st">'Men'</span>,<span class="st">'Women'</span>],<span class="st">'Income ($, thousands)'</span>, <span class="st">"Income Sample Means"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="W08%20Linear%20Regression_files/figure-html/cell-39-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>There we have it: A stark, quantitative representation of the gender wage gap.</p>
<p>If we simply compared the means between a sample of women and a sample of men, the best we could do in terms of inference would be to say something like “the average income for men was $19k higher than it was for women.” Though this is an important finding, the central limit theorem lets us add important context.</p>
<pre><code>1. We took 10,000 large samples of men and calculated the means of each sample.
2. We found that over 99.7% of them were greater than $55,000. 
3. We took 10,000 large samples of women and calculated the means of each sample.
4. We found that over 99.7% of them were smaller than $47,000.</code></pre>
<p>The fact that the distribution of income sample means between men and women do not overlap at all tells us that the probability of this variation in incomes being due to random chance is extremely, extremely small. Thus, we can say that the observed difference in income between men and women is <strong>statistically significant</strong>. We’ll delve more in to what that means next week.</p>
</section>
</section>
<section id="extension" class="level2">
<h2 class="anchored" data-anchor-id="extension">Extension</h2>
<p>Given that we’ve used functions to create these plots, we can make plots with different data relatively easily. Intersectionality is an important consideration when thinking about inequality. The code below allows you to create a subset of income for white men:</p>
<p><code>w_men=df[(df['sex']==1)&amp;(df['race']==1)]['income']</code></p>
<p>There is a strong gendered difference in income, but what about the effects of both race and gender? How does union membership mitigate these inequalities? What if we only compare people in the same types of jobs? Try creating subsets based on these characteristics and plotting distributions of sample means to answer these questions.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>