<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Quantitative Methods 2 - Causal Inference</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../notebooks/W09. Linear Regression.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-154866877-2', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Causal Inference</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Quantitative Methods 2</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/oballinger/QM2/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Download" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-download"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="../Quantitative-Methods-2.pdf">
            <i class="bi bi-bi-file-pdf pe-1"></i>
          Download PDF
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="../Quantitative-Methods-2.epub">
            <i class="bi bi-bi-journal pe-1"></i>
          Download ePub
          </a>
        </li>
    </ul>
    <a href="" title="Share" id="sidebar-tool-dropdown-1" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-1">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">Welcome</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/W01. Python Recap.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Python Recap</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/W02. Pandas.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Intro to Pandas</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/W03. Spatial Data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Spatiotemporal Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/W04. Natural Language Processing.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Natural Language Processing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/W05. Merging and Joining.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Merging and Joining</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Week 6.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Group Presentations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/W07. Distributions and Basic Statistics.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Distributions and Basic Statistics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Week 8.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Regression</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/W09. Linear Regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Linear Regression</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/W10. Causal Inference.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Causal Inference</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#workshop-10-open-in-colab" id="toc-workshop-10-open-in-colab" class="nav-link active" data-scroll-target="#workshop-10-open-in-colab"><em>Workshop 10</em> <img src="https://github.com/oballinger/QM2/blob/main/colab-badge.png?raw=1" class="img-fluid" alt="Open In Colab"></a>
  <ul class="collapse">
  <li><a href="#aims" id="toc-aims" class="nav-link" data-scroll-target="#aims">Aims:</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.dev/oballinger/QM2/blob/main/notebooks/W10. Causal Inference.ipynb" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Causal Inference</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="workshop-10-open-in-colab" class="level2">
<h2 class="anchored" data-anchor-id="workshop-10-open-in-colab"><em>Workshop 10</em> <a href="https://colab.research.google.com/github/oballinger/QM2/blob/main/notebooks/W10.%20Causal%20Inference.ipynb"><img src="https://github.com/oballinger/QM2/blob/main/colab-badge.png?raw=1" class="img-fluid" alt="Open In Colab"></a></h2>
<section id="aims" class="level3">
<h3 class="anchored" data-anchor-id="aims">Aims:</h3>
<p>This workshop builds on last week’s material– now that we know what a basic regression looks like, we’ll be looking at three different types of regression that let us extract more robust and even plausibly causal insights from our data:</p>
<ol type="1">
<li>Panel Regression</li>
<li>Difference in Differences</li>
<li>Regression Discontinuity</li>
</ol>
<p>Our focus area will be the United States, where we’ll be looking at the relationship between electoral outcomes, unemployment, and the minimum wage. We’ll also be bringing back material from previous weeks (particularly Week 3 - Spatial Data and Week 5 - Merging and Joining) to show how the different things we’ve learned fit together. First, as always, we must import the libraries we’ll need for this project.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-12-12T14:51:36.716574Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-12-12T14:51:36.716022Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-12-12T14:51:36.721783Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-12-12T14:51:36.720896Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2022-12-12T14:51:36.716532Z&quot;}" data-trusted="true" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!pip install linearmodels</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.formula.api <span class="im">import</span> ols</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.iolib.summary2 <span class="im">import</span> summary_col</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(font_scale<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"white"</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.figsize'</span>] <span class="op">=</span> (<span class="dv">12</span>, <span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This workshop is going to involve combining a number of different datasets:</p>
<ul>
<li><p><code>state_data.csv</code>: Monthly state-level unemployment data from the <a href="www.bls.gov">Bureau of Labor Statistics (BLS)</a> spanning 1976-2022, and state-level minimum wage data from <a href="https://www.kaggle.com/datasets/lislejoem/us-minimum-wage-by-state-from-1968-to-2017">Kaggle</a> spanning 1968-2020.</p></li>
<li><p><code>elections.csv</code>: county-level U.S. Presidential election results spanning 2000-2020 from the <a href="https://electionlab.mit.edu/data">MIT Election Lab</a>.</p></li>
<li><p><code>geojson-counties-fips.json</code>: a county-level geospatial file used for making maps.</p></li>
</ul>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>mkdir data</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>mkdir data<span class="op">/</span>wk10</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>curl https:<span class="op">//</span>storage.googleapis.com<span class="op">/</span>qm2<span class="op">/</span>wk10<span class="op">/</span>state_data.csv <span class="op">-</span>o data<span class="op">/</span>wk10<span class="op">/</span>state_data.csv</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>curl https:<span class="op">//</span>storage.googleapis.com<span class="op">/</span>qm2<span class="op">/</span>wk10<span class="op">/</span>elections.csv <span class="op">-</span>o data<span class="op">/</span>wk10<span class="op">/</span>elections.csv</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>curl https:<span class="op">//</span>storage.googleapis.com<span class="op">/</span>qm2<span class="op">/</span>wk10<span class="op">/</span>geojson<span class="op">-</span>counties<span class="op">-</span>fips.json <span class="op">-</span>o data<span class="op">/</span>wk10<span class="op">/</span>geojson<span class="op">-</span>counties<span class="op">-</span>fips.json</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>mkdir: data: File exists
mkdir: data/wk10: File exists
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 2424k  100 2424k    0     0  4878k      0 --:--:-- --:--:-- --:--:-- 4917k
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  875k  100  875k    0     0  2506k      0 --:--:-- --:--:-- --:--:-- 2529k
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 3141k  100 3141k    0     0  6498k      0 --:--:-- --:--:-- --:--:-- 6558k</code></pre>
</div>
</div>
<table class="table">
<colgroup>
<col style="width: 100%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">## Panel Regression</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Intercept 65.608*** 74.605*** 68.971*** 73.383*** 70.706*** 81.721<strong><em> (0.572) (0.684) (0.680) (0.727) (0.788) (0.797) unemployment -1.782</em></strong> -2.351*** -1.891*** -1.618*** -1.101*** -2.322<strong><em> (0.122) (0.114) (0.109) (0.088) (0.142) (0.114) population -0.021</em></strong> -0.021*** -0.023*** -0.024*** -0.034*** -0.029<strong><em> (0.001) (0.001) (0.001) (0.002) (0.002) (0.002) R-squared 0.118 0.172 0.148 0.165 0.142 0.230 R-squared Adj. 0.117 0.171 0.148 0.165 0.141 0.229 N 3113 3114 3114 3114 3115 3114 ========================================================================== Standard errors in parentheses. </em> p&lt;.1, </strong> p&lt;.05, ***p&lt;.01 ``` ::: :::</td>
</tr>
<tr class="even">
<td style="text-align: left;">This table is pretty informative. Using what we learned from last week, we can say that for the 2020 election,</td>
</tr>
<tr class="odd">
<td style="text-align: left;">* A 1% increase in the unemployment rate was associated with a 2.3% <em>decrease</em> in republican voteshare. * A 1000-person increase in population was associated with 0.029% decrease in republican voteshare. * both of these results are statistically signifiant at the 0.01 level. * 23% of the variation in republican voteshare can be explained by unemployment and population.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Crucially, “increase” in this context pertains to <em>differences in between counties</em>!</td>
</tr>
<tr class="odd">
<td style="text-align: left;">We can also compare these results across different elections. The coefficient for the unemployment variable in 2020 is over twice the size of the same coefficient in 2016! So it looks like actually unemployment and republican voteshare are <em>negatively</em> related, contrary to popular belief.</td>
</tr>
<tr class="even">
<td style="text-align: left;">But is this the whole story?</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Below, i’ve isolated West Virginia, one of the states with the highest unemployment rates in America. Instead of drawing a new regression line every year, i’ve drawn a new regression line for each county over the six elections.</td>
</tr>
<tr class="even">
<td style="text-align: left;">::: {.cell execution_count=11}</td>
</tr>
<tr class="odd">
<td style="text-align: left;">::: {.cell-output .cell-output-display execution_count=11}</td>
</tr>
<tr class="even">
<td style="text-align: left;">::: {.cell-output .cell-output-display} <img src="W10. Causal Inference_files/figure-html/cell-10-output-2.png" class="img-fluid"> ::: :::</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Within a given county, an increase in the unemployment rate is associated with an <strong>increase</strong> in republican voteshare! This is where the second question comes in (variation within counties).</td>
</tr>
<tr class="even">
<td style="text-align: left;">We got away with doing a series of cross-sectional analyses (a new regression for each election) because we have over 3000 counties, so <span class="math inline">\(n&gt;3000\)</span> for each of those regressions (though even so, we’re still splitting our data up and it would be better to leverage the full dataset of &gt;18000 observations in one regression). It also provides relatively useful information about the importance of unemployment across the country for each election. We can’t really apply the same thinking to this situation, since we only have six time periods. If we ran a separate regression for each county, we would only have six observations per regression– nowhere near enough to satisfy the central limit theorem (at least n&gt;30). The insights would also be of limited utility; we would get over 3000 unique estimates for the realtionship between county-level employment and election results. Imagine trying to fit <em>that</em> into one table.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Luckily, there’s a way of modeling this relationship that allows us to account for differences in between counties, while also capturing the variation within counties. This is called a <strong>Fixed Effect regression</strong></td>
</tr>
<tr class="even">
<td style="text-align: left;">&gt; <strong>Fixed Effects Models</strong>: In experimental research, unmeasured differences between subjects are often controlled for via random assignment to treatment and control groups. Hence, even if a variable like Socio-Economic Status is not explicitly measured, because of random assignment, we can be reasonably confident that the effects of SES are approximately equal for all groups. Of course, random assignment is usually not possible with most survey research. If we want to control for the effect of a variable, we must explicitly measure it. If we don’t measure it, we can’t control for it. In practice, there will almost certainly be some variables we have failed to measure (or have measured poorly), so our models will likely suffer from some degree of omitted variable bias. &gt;When we have panel data (the same people/states/counties. etc. measured at two or more points in time) another alternative presents itself: we can use the subjects as their own controls. With panel data we can control for stable characteristics (i.e.&nbsp;characteristics that do not change across time) whether they are measured or not. These include such things as sex, race, and ethnicity for individuals, or urban/rural, topography, economic structure for geographic areas. The idea is that, whatever effect these variables have at one point in time, they will have the same effect at a different point in time because the values of such variables do not change.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A fixed effect regression takes the following form:</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math display">\[\huge Y_{it}=\alpha_i+\beta X_{it}+\epsilon_{it}\]</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Where: * <span class="math inline">\(X_{it}\)</span> are the independent variables (e.g.&nbsp;population and unemployment) whose values vary over time. * <span class="math inline">\(\beta\)</span> is the slope coefficient for variable <span class="math inline">\(x\)</span> (e.g.&nbsp;unemployment). The model assumes that these effects are time-invariant, e.g.&nbsp;the effect of <span class="math inline">\(x\)</span> is the same at same 1 as it is at time 4 (although the value of <span class="math inline">\(x\)</span> can be different at different time periods). * <span class="math inline">\(\alpha_i\)</span> and <span class="math inline">\(\epsilon_{it}\)</span> are both error terms. <span class="math inline">\(\epsilon_{it}\)</span> is different for each individual at each point in time. <span class="math inline">\(\alpha_i\)</span> only varies across individuals but not across time. We can think of <span class="math inline">\(\alpha_i\)</span> as representing the effects of all the time invariant/stable variables that have NOT been included in the model. So, given that we have 6 time periods for each county then the six records for county 1 would all have the same value for <span class="math inline">\(\alpha_1\)</span>, the six records for county 2 would all have the same value for <span class="math inline">\(\alpha_2\)</span>, etc. But, <span class="math inline">\(\epsilon_{it}\)</span> is free to be different for every case at every time period.</td>
</tr>
<tr class="even">
<td style="text-align: left;">A fixed effect regression allows us to account for <span class="math inline">\(\alpha_i\)</span> through a technique called <strong>demeaning</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&gt;<strong>Demeaning</strong>: After demeaning, all variables for all cases have a mean of 0. That means that all the between-subject variability has been eliminated. All that is left is the within-subject variability. So, with a fixed effects model, we are analyzing what causes individual’s values to change across time. Variables whose values do not change (like race or gender) cannot cause changes across time (unless their effects change across time as well). However, whatever effect they have at one time is the same effect that they have at other times, so the effects of such stable characteristics are controlled.</td>
</tr>
<tr class="even">
<td style="text-align: left;">In essence, you can picture this as allowing you to draw a separate regression line through each set of observations from the same group in your data (in this case, one county over time); however, while the <em>intercept</em> of these lines can vary (their absolute position), they will all have the same <em>slope</em> and will therefore be parallel. This is important, as we want to find one slope– one common effect of x– that fits <em>all</em> groups.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">::: {.cell execution_count=12} ``` {.python .cell-code} from linearmodels import PanelOLS from linearmodels import RandomEffects import statsmodels.formula.api as smf from linearmodels.panel import compare</td>
</tr>
<tr class="even">
<td style="text-align: left;">df_c=df_c.set_index([‘county_fips’,‘year’]) # set the index to the county fips code and the year panel = PanelOLS.from_formula(‘r_votes ~ 1 + population + unemployment + EntityEffects’,df_c).fit() # run a fixed effects model print(compare({‘Fixed Effects’: panel,}, stars=True)) # print the model formatted as a regression table ```</td>
</tr>
<tr class="odd">
<td style="text-align: left;">::: {.cell-output .cell-output-stdout} ``` Model Comparison ====================================== Fixed Effects</td>
</tr>
</tbody>
</table>
<p>Dep. Variable r_votes Estimator PanelOLS No.&nbsp;Observations 18684 Cov. Est. Unadjusted R-squared 0.0227 R-Squared (Within) 0.0227 R-Squared (Between) -0.1949 R-Squared (Overall) -0.1627 F-statistic 180.40 P-value (F-stat) 0.0000 ===================== ============ Intercept 61.986<strong><em> (246.29) population -0.0698</em></strong> (-17.332) unemployment 0.2829*** (9.6749) ======================= ============== Effects Entity ————————————–</p>
<p>T-stats reported in parentheses</p>
<pre><code>:::
:::


When accounting for time-invariant differences between counties, the effect of population remains negative. This suggests that counties in which the population is *decreasing* tend to experience an increase in republican voteshare. More specifically, for every 1000 people that leave a county, republican voteshare increases by 0.06%. 

The really interesting part of this regression table, however, is the coefficient on the unemployment variable, which is now positive. This suggests that-- once we account for the differences between counties-- an increase in the unemployment rate *within* a county is *positively* associated with republican voteshare. Indeed, a 1% increase in the unemployment rate leads to a 0.28% increase in republican voteshare. 

This regression output even gives us three separate $R^2$ values-- one for between-variation, another for within, and one overall. 

---------------------------
## 2. Difference in Difference

One of the reasons that we observe a signficant relationship between unemployment and voting behaviour is that the Republican and Democratic parties have opposing views on what to do about unemployment. Democratic lawmakers have historically been in favour of increasing the minimum wage to benefit low-income workers, while Republicans have generally opposed this on the basis that it would hurt these very workers by increase unemployment. Indeed, classical economic theory holds that an increase in wages would lead to a reduction in employment; A business that makes $100k in revenue per year and spends all of it on employing 20 people can't suddenly start paying their workers double their salaries-- unless it fires half of its workers. This is obviously a simplified model though-- minimum wage laws typically don't double wages, and businesses don't operate at-cost, they turn a profit which they could use to pay their workers more. In the rest of this workshop, we're going to be investigating this question empirically: 

### Do minimum wage laws increase unemployment?

Note that this is a *causal* question; i'm not asking if they're correlated-- i'm asking if one causes the other. The burden of proof here is much higher than observing correlations, and we have to think seriously about **endogeneity**. In partiuclar, we need to account for the influence of omitted variables (e.g. a recession, or the economic composition of a state), the potential for reverse causality (states implementing minimum wage laws in response to unemployment crises), and selection bias.

In a lab, you can conduct causal inference by running an experiment. You can randomly select individuals, split them into a control group and a treatment group, measure their values in an outcome variable prior to a treatment, administer a treatment, and measure their respective values after the treatment. If you observe a change in the outcome variable in the treatment group after having administered the treatment, you can interpert that as the causal effect of treatment. This is because we're able to make a plausible argument that the **control group can act as a counterfactual (a stand-in) for the treatment group in the absence of treatment**. Both groups had the same values before the treatment, then the only thing that changed between them was the treatment, so if we observe a change in the outcome variable, it must be due to treatment.

In the real world, we rarely get to run expermients of this kind. Instead, we have to hunt for **natural experiments**: situations in which there is a **treatment** which we're interested in measuring the effect of, and two groups that can plausibly act as a treatment and control group. 

&gt; **[Difference in Difference](https://www.publichealth.columbia.edu/research/population-health-methods/difference-difference-estimation#:~:text=DID%20relies%20on%20a%20less,individual%20level%20is%20not%20possible.)** is a quasi-experimental design that makes use of longitudinal data from treatment and control groups to obtain an appropriate counterfactual to estimate a causal effect. DID is typically used to estimate the effect of a specific intervention or treatment (such as a passage of law, enactment of policy, or large-scale program implementation) by comparing the changes in outcomes over time between a population that is enrolled in a program (the intervention group) and a population that is not (the control group).

The Difference in Difference model can be estimated as a simple regression model of the following form: 

$$\huge Y_{it} = \beta_0 + \beta_1 Treatment_i + \beta_2 Post_t + \beta_3 (Treatment_i \times Post_t) + \varepsilon_{it}$$

- $Treatment_i$ is 0 for the control group and 1 for the treatment group
- $Post_t$ is 0 for before and 1 for after

we can insert the values of $Treatment$ and $Post$ using the table below and see that coefficient ($\beta_3$) of the interaction of $Treatment$ and $Post$ is the Difference in Differences (DID) estimator:

|              | Control Group  | Treatment Group                    |    Difference              |
|--------------|---------------------|-----------------------------------------|-----------------|
| Before  | $\beta_0$           | $\beta_0 + \beta_1$                     | $\beta_1$                |
| After   | $\beta_0 + \beta_2$ | $\beta_0 + \beta_1 + \beta_2 + \beta_3$ | $\beta_1 + \beta_3$                |
| Difference   | $\beta_2$           | $\beta_2 + \beta_3$                     | **$\beta_3$** (DID) |


[Card and Krueger (1994)](https://davidcard.berkeley.edu/papers/njmin-aer.pdf) found one such natural experiment, allowing them to estimate the causal effect of an increase in the state minimum wage on unemployment using a DiD model; In 1992, New Jersey raised the state minimum wage from \$4.25 to \$5.05 while the minimum wage in neighbouring Pennsylvania stayed the same at \$4.25. 
   
* Treatmeng Group: New Jersey 
* Control Group: Pennsylvania
* Pre-Treatment Period: before 1992
* Post-Treatment Period: after 1992

They conducted a survey of 384 fast-food restaurants across both states, right before and right after the law came into effect in New Jersey, asking them how many people they employed. They ran a Difference-in-Differences model, and found that the coefficient $\beta_3$ was positive but not statistically significant. In other words, the average total employees per restaurant *increased* after the minimum wage increased, but this could have been due to random chance. 

That was a long time ago. Things have changed since then, including the fact that we have access to a lot more data and computational power. Let's see if we can replicate Card and Krueger's results with more recent data. I've downloaded data on unemployment, minimum wage levels, and Gross Domestic Product at the state level going back to 1976. Let's have a look at minimum wages in New Jersey and Pennsylvania over time:

::: {.cell execution_count=13}
``` {.python .cell-code}
df_s=pd.read_csv('data/wk10/state_data.csv', parse_dates=['date']) # read in the state-level data
did=df_s[df_s['state'].isin(['pennsylvania', 'new jersey'])] # subset the data to only include pennsylvania and new jersey

px.line(did, x='date', y='minwage', color='state', title="Minimum Wages in New Jersey and Pennsylvania") # plot the minimum wage over time</code></pre>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
<p>:::</p>
<p>The plot above sort of looks like a set of descending staircases; this is for two reasons. The plateaus exist because each row in the dataframe <code>df_s</code> is the value of a state in a given <em>month</em>, but we only have minimum wage data for every <em>year</em>. So we get 12 consecutive values of minimum wage every year. The reason that the staircases are descending is because these minimum wages are adjusted for inflation. No matter where you’re from, you’ve probably heard a grandparent say something along the lines of “My parents would send me to the shops with 25 cents to buy groceries for the week”, but now it costs £9 for a bag of chips. That’s inflation– every year things tend to get slightly more expensive, so if the same <em>absolute</em> minimum wage actually diminishes in “real” terms, which is what the variable <code>minwage</code> measures. Incidentally, this is one of the main reasons University staff have been on <a href="https://www.ucu.org.uk/article/11830/University-staff-pay-cut-by-20-new-figures-show">strike</a>. Anyway. Back to minimum wages.</p>
<p>This plot shows that for the past fifty years, New Jersey and Pennsylvania have had largely similar minimum wage policies. There have been a couple moments of divergence, including in the 1990s when the Card and Krueger study was conducted. However, the biggest divergence actually started taking place in 2014 when New Jersey seems to have begun taking a wildly different approach. While Pennsylvania has had the same minimum wage since 2008 (and therefore seen a decline in inflation-adjusted wages), New Jersey has raised the minimum wage significantly twice. In 2020, New Jersey’s minimum wage was around 50% higher than Pennsylvania’s. We can exploit the fact that these two states have historically had similar minimum wage laws but have recently experienced a big divergence to see if that change in minimum wages has resulted in a change in employment levels.</p>
<p>Our Difference-in-Differences setup is as follows:</p>
<p><span class="math display">\[\large Unemployment_{state, year} = \beta_0 + \beta_1 Treatment_{state} + \beta_2 Post_{year} + \beta_3 (Treatment_{state} \times Post_{year}) + \beta_4 GDP_{state,year} + \varepsilon_{it}\]</span></p>
<ul>
<li>New Jersey is the <strong>treatment group</strong></li>
<li>Pennsylvania is the <strong>control group</strong></li>
<li>Years before 2014 is the <strong>pre-treatment period</strong></li>
<li>Years after 2014 is the <strong>post-treatment period</strong></li>
</ul>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>did[<span class="st">'post'</span>]<span class="op">=</span>np.where(did[<span class="st">'date'</span>]<span class="op">&gt;=</span><span class="st">'2014-01-01'</span>,<span class="dv">1</span>,<span class="dv">0</span>) <span class="co"># create a variable that is 1 if the date is after the minimum wage increase and 0 otherwise</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>did[<span class="st">'treatment'</span>]<span class="op">=</span>np.where(did[<span class="st">'state'</span>]<span class="op">==</span><span class="st">'new jersey'</span>,<span class="dv">1</span>,<span class="dv">0</span>) <span class="co"># create a variable that is 1 if the state is new jersey (i.e., the treatment group) and 0 for pennsylvania (the control group)</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>did[<span class="st">'post_treatment'</span>]<span class="op">=</span>did[<span class="st">'post'</span>]<span class="op">*</span>did[<span class="st">'treatment'</span>] <span class="co"># create a variable that is 1 if the date is after the minimum wage increase and the state is new jersey and 0 otherwise</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before we proceed with the analysis, though, we need to satisfy two assumptions that will allow us to argue that Pennsylvania can act as a valid control group for New Jersey:</p>
<ol type="1">
<li>No simultaneous treatments:
<ul>
<li>If, for example, New Jersey suddenly entered a massive recession in 2014 as well, we couldn’t really argue that resulting effects on employment are due solely to the minimum wage law. To account for this, we’ll be including state-level GDP as an additional independent variable in our DiD model.</li>
</ul></li>
<li>Parallel Trends:
<ul>
<li>Both states have to have been experiencing similar trends in the <strong>dependent variable</strong> (unemployment) prior to the treatment (minimum wage law). If they were trending in opposite directions for unobserved reasons, ensuing differences in unemployment may be due to those unobserved reasons rather than the treatment.</li>
<li>We can check this by plotting the dependent variable for both groups over time, and indicating the timing of the treatment.</li>
</ul></li>
</ol>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>did<span class="op">=</span>did[(did[<span class="st">'date'</span>]<span class="op">&gt;=</span><span class="st">'2008-01-01'</span>) <span class="op">&amp;</span> (did[<span class="st">'date'</span>]<span class="op">&lt;=</span><span class="st">'2020-01-01'</span>)]</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>did,x<span class="op">=</span><span class="st">'date'</span>,y<span class="op">=</span><span class="st">'unemployment'</span>,hue<span class="op">=</span><span class="st">'state'</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>plt.axvline(pd.to_datetime(<span class="st">'2014-01-01'</span>),color<span class="op">=</span><span class="st">'black'</span>,linestyle<span class="op">=</span><span class="st">'dashed'</span>, label<span class="op">=</span><span class="st">'NJ Minimum Wage Increase'</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Unemployment in Pennsylvania and New Jersey'</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>plt.legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>&lt;matplotlib.legend.Legend at 0x174874b20&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="W10. Causal Inference_files/figure-html/cell-14-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>This plot shows a big spike in unemployment occurring for both Pennsylvania and New Jersey as a result of the 2008 financial crisis. New jersey had a higher unemployment rate than Pennsylvania, but their trends are largely parallel and decreasing after 2012. In the years following the minimum wage law, New Jersey’s unemployment rate actually dips below Pennsylvania’s for the first time in years. Let’s look at this in the form of boxplots:</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>did[<span class="st">'category'</span>]<span class="op">=</span>did[<span class="st">'treatment'</span>].astype(<span class="bu">str</span>)<span class="op">+</span>did[<span class="st">'post'</span>].astype(<span class="bu">str</span>) <span class="co"># this variable is just for the plot below</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>sns.boxplot(x<span class="op">=</span><span class="st">'category'</span>, y<span class="op">=</span><span class="st">'unemployment'</span>, hue<span class="op">=</span><span class="st">'treatment'</span>, data<span class="op">=</span>did).set_xticklabels([<span class="st">"Pre x Treatment"</span>, <span class="st">"Pre x Control"</span>,<span class="st">'Post x Treatment'</span>,<span class="st">'Post x Control'</span>]) </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">''</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Unemployment Rates by Treatment and Post Treatment'</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="W10. Causal Inference_files/figure-html/cell-15-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>This plot is fascinating in and of itself. The two box plots on the left show the unemployment values of the counties prior to the minimum wage law in 2014, while the two on the right show their values after the minimum wage increases. Pennsylvania (the “control” group) is colored in blue, and New Jersey (the “treatment” group) is colored orange. Prior to the minimum wage increase in 2014, Pennsylvania (blue) has a lower unemployment rate than New Jersey (orange). In the years following New Jersey’s passage of the minimum wage law, New Jersey actually has a <em>lower</em> unemployment rate than Pennsylvania! This is the only boxplot where the “treatment” (a minimum wage law) is being applied, and it has the lowest unemployment rate.</p>
<p>Let’s see if this difference is statistically signfiicant, and calculate a treatment effect:</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>did_model <span class="op">=</span> ols(<span class="st">'unemployment ~ gdp+ post + treatment + post_treatment'</span>, did).fit()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(did_model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:           unemployment   R-squared:                       0.704
Model:                            OLS   Adj. R-squared:                  0.699
Method:                 Least Squares   F-statistic:                     169.1
Date:                Mon, 19 Dec 2022   Prob (F-statistic):           5.70e-74
Time:                        09:20:32   Log-Likelihood:                -420.68
No. Observations:                 290   AIC:                             851.4
Df Residuals:                     285   BIC:                             869.7
Df Model:                           4                                         
Covariance Type:            nonrobust                                         
==================================================================================
                     coef    std err          t      P&gt;|t|      [0.025      0.975]
----------------------------------------------------------------------------------
Intercept         15.6515      1.277     12.254      0.000      13.137      18.166
gdp            -1.343e-05   2.05e-06     -6.544      0.000   -1.75e-05   -9.39e-06
post              -0.5845      0.307     -1.904      0.058      -1.189       0.020
treatment         -0.3641      0.295     -1.234      0.218      -0.945       0.217
post_treatment    -1.9532      0.258     -7.581      0.000      -2.460      -1.446
==============================================================================
Omnibus:                      111.434   Durbin-Watson:                   0.319
Prob(Omnibus):                  0.000   Jarque-Bera (JB):              320.366
Skew:                          -1.772   Prob(JB):                     2.71e-70
Kurtosis:                       6.735   Cond. No.                     1.34e+07
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 1.34e+07. This might indicate that there are
strong multicollinearity or other numerical problems.</code></pre>
</div>
</div>
<p>There are some really interesting results from this model– let’s interpret the coefficients one by one.</p>
<ul>
<li><code>gdp</code>: GDP is inversely related to unemployment. This makes sense: GDP basically measures the total amount of economic activity, so more economic activity = more employment.</li>
<li><code>post</code>: this coefficient is negative, but statistically insignificant at the 0.05 level; it indicates that unemployment <em>generally</em> decreased for both groups, but that this could be due to random chance.</li>
<li><code>treatment</code>: again negative but insignficant, meaning that there is no significant difference in unemployment levels between NJ and PA over the entire period.</li>
<li><code>post_treatment</code>: this is our difference-in-differences estimator, and reflects the causal effect of treatment. It is negative and statistically significant. If we believe that the asusmptions of our model are satisfied, we can claim that:
<ul>
<li><strong>The introduction of a minimum wage in New Jersey led to a 1.95% decrease in unemployment relative to Pennsylvania</strong></li>
</ul></li>
</ul>
<p>This is a bold claim. We should do our best to back it up. Notice that i’ve sort of arbitrarily chosen a window of dates around the minimum wage law– maybe this result is a fluke, due to the timespan ive chosen.</p>
<p>To address this concern, I’ll run the same model 10 times, starting with a really small time window– just one year on either side of the law– and progressively expand it.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>models<span class="op">=</span>[] <span class="co"># create empty list to store the models</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>names<span class="op">=</span>[] <span class="co"># create empty list to store the names of the models</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> window <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">10</span>): <span class="co"># loop through years from 2000 to 2020 in increments of 4</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    did<span class="op">=</span>df_s[(df_s[<span class="st">'date'</span>]<span class="op">&gt;=</span><span class="bu">str</span>(<span class="dv">2014</span><span class="op">-</span>window)<span class="op">+</span><span class="st">'-01-01'</span>) <span class="op">&amp;</span> (df_s[<span class="st">'date'</span>]<span class="op">&lt;=</span><span class="bu">str</span>(<span class="dv">2014</span><span class="op">+</span>window)<span class="op">+</span><span class="st">'-01-01'</span>) <span class="op">&amp;</span> df_s[<span class="st">'state'</span>].isin([<span class="st">'pennsylvania'</span>, <span class="st">'new jersey'</span>])] <span class="co"># subset the data within the window of interest around 2014</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    did[<span class="st">'post'</span>]<span class="op">=</span>np.where(did[<span class="st">'date'</span>]<span class="op">&gt;=</span><span class="st">'2014-01-01'</span>,<span class="dv">1</span>,<span class="dv">0</span>) <span class="co"># create a dummy variable indicating the period after the minimum wage increase</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    did[<span class="st">'treatment'</span>]<span class="op">=</span>np.where(did[<span class="st">'state'</span>]<span class="op">==</span><span class="st">'new jersey'</span>,<span class="dv">1</span>,<span class="dv">0</span>) <span class="co"># create a dummy variable for treatment</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    did[<span class="st">'post_treatment'</span>]<span class="op">=</span>did[<span class="st">'post'</span>]<span class="op">*</span>did[<span class="st">'treatment'</span>] <span class="co"># create an interaction term between the post and treatment variables</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    did_model <span class="op">=</span> ols(<span class="st">'unemployment ~ gdp+ post + treatment + post_treatment'</span>, did).fit() <span class="co"># run the difference in difference model</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    models.append(did_model) <span class="co"># append the model to the list of models</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    names.append(<span class="st">'± '</span><span class="op">+</span><span class="bu">str</span>(window)<span class="op">+</span><span class="st">' Year'</span>) <span class="co"># append the name of the model to the list of names</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>table<span class="op">=</span>summary_col( <span class="co"># create a regression table </span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    models, <span class="co"># pass the models to the summary_col function</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    stars<span class="op">=</span><span class="va">True</span>, <span class="co"># add stars denoting the p-values of the coefficient to the table; * p&lt;0.05, ** p&lt;0.01, *** p&lt;0.001</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    float_format<span class="op">=</span><span class="st">'</span><span class="sc">%0.3f</span><span class="st">'</span>, <span class="co"># set the decimal places to 3</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    model_names<span class="op">=</span>names, <span class="co"># set the names of the model</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    info_dict <span class="op">=</span> {<span class="st">"N"</span>:<span class="kw">lambda</span> x: <span class="st">"</span><span class="sc">{0:d}</span><span class="st">"</span>.<span class="bu">format</span>(<span class="bu">int</span>(x.nobs))}) <span class="co"># add the number of observations to the table</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(table) <span class="co"># print the table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=======================================================================================================
               ± 1 Year  ± 2 Year  ± 3 Year  ± 4 Year  ± 5 Year  ± 6 Year  ± 7 Year  ± 8 Year  ± 9 Year
-------------------------------------------------------------------------------------------------------
Intercept      21.423** 33.130*** 24.228*** 22.751*** 19.711*** 15.651*** 2.327     -0.580    -2.340*  
               (9.399)  (2.324)   (1.333)   (0.876)   (0.746)   (1.277)   (2.183)   (1.579)   (1.398)  
gdp            -0.000   -0.000*** -0.000*** -0.000*** -0.000*** -0.000*** 0.000**   0.000***  0.000*** 
               (0.000)  (0.000)   (0.000)   (0.000)   (0.000)   (0.000)   (0.000)   (0.000)   (0.000)  
post           -0.619   0.100     -0.262    -0.256*   -0.483*** -0.585*   -2.277*** -2.792*** -3.205***
               (0.411)  (0.194)   (0.162)   (0.140)   (0.154)   (0.307)   (0.576)   (0.501)   (0.479)  
treatment      -1.604   -3.686*** -1.850*** -1.466*** -0.903*** -0.364    1.825***  2.139***  2.241*** 
               (1.896)  (0.479)   (0.285)   (0.190)   (0.169)   (0.295)   (0.509)   (0.402)   (0.363)  
post_treatment -0.837** -1.707*** -1.848*** -2.108*** -2.111*** -1.953*** -0.780*   -0.375    -0.030   
               (0.323)  (0.158)   (0.134)   (0.115)   (0.130)   (0.258)   (0.469)   (0.426)   (0.409)  
R-squared      0.856    0.934     0.938     0.952     0.933     0.704     0.194     0.167     0.165    
R-squared Adj. 0.844    0.931     0.936     0.951     0.932     0.699     0.184     0.158     0.157    
N              50       98        146       194       242       290       338       384       408      
=======================================================================================================
Standard errors in parentheses.
* p&lt;.1, ** p&lt;.05, ***p&lt;.01</code></pre>
</div>
</div>
<p>The row we’re mainly interested in is the <code>post_treatment</code> coefficient, the treatment effect. It remains significant and negative in all time periods smaller than 8 years, after which point it becomes insignificant;</p>
<p>How do you think this affects our conclusion?</p>
<table class="table">
<tbody>
<tr class="odd">
<td>## Regression Discontinuity</td>
</tr>
<tr class="even">
<td>Our difference in difference model made causal claims by treating PA as a control group for NJ on the basis that they had similar trends in unemployment before the minimum wage law, and diverging trends after, and no other shock coincided with this policy. We could still poke some holes in that– NJ seems to have fared worse than PA after the 2008 crisis; maybe more people work in finance in NJ. Indeed, Jersey City is across the water from Manhattan, America’s financial centre. Bankers would be hard hit by a financial crisis, but are probably not that affected by minimum wage laws. Conversely, Pennsylvania is the 3rd largest coal-producing state in the U.S.– coal miners are probably less affected by financial crises, but more likely to be earning minimum wage. As such, increasing the minimum wage in a place where most people are bankers probably has less of an effect on unemployment compared to an area where everyone is a coal miner.</td>
</tr>
<tr class="odd">
<td>Running a state-level analysis is subject to this sort of selection bias, since by looking at state averages we’re effectively comparing places like Jersey City to places like <a href="https://en.wikipedia.org/wiki/Centralia,_Pennsylvania">Centralia</a>, a coal-mining town in central Pennsylvania which saw its population decline from 1000 in 1980 to just five residents in 2020. So the next step in our analysis might be to try to compare apples to apples. There are a number of ways of doing this– we could look at the unemployment rate by industry, for example. But what if we didn’t want to rely on pre-trends, or if we didn’t even have data prior to the treatment? This is often the case</td>
</tr>
<tr class="even">
<td>To build a more valid counterfactual, we can drill even deeper to find even more similar comparison groups using a <strong>Regression Discontinuity Design (RDD)</strong> using county (rather than state) level data.</td>
</tr>
<tr class="odd">
<td>&gt; <strong><a href="https://www.princeton.edu/~davidlee/wp/RDDEconomics.pdf">Regression Discontinuity Designs</a></strong> are a method of estimating treatment effects in a nonexperimental setting where treatment is determined by whether an observed “assignment” variable exceeds a known cutoff point. If the cutoff is exogenous to the treatment, observations in the vicinity of this cutoff are likely to be very similar, and assignment to the treatment or control group can be considered as good as random.</td>
</tr>
<tr class="even">
<td>RDD models generally take the following form:</td>
</tr>
<tr class="odd">
<td><span class="math display">\[\huge Y_{i} = \beta_0 + \beta_1 X_i + \beta_2 D_i + \varepsilon_{i}\]</span> <span class="math display">\[\large D_i=    \begin{cases}
1 &amp; X_i&gt;X_k\\
0 &amp; X_i&lt;X_k\\
\end{cases} \]</span></td>
</tr>
<tr class="even">
<td>In our case, the treatment is the minimum wage law passed in NJ in 2014. We want to be looking at the period after this to pick up on any changes in employment. The <strong>assignment variable</strong> in this case could be the distance of a county to the border between the two states, and the sharp cutoff would be the border itself. Counties on the border counties are probably much more similar to each other than other, farther away counties: this would exclude both Jersey City (in the far east of NJ) and Centralia (in the centre of PA).</td>
</tr>
<tr class="odd">
<td>Indeed, several cities are divided by the border between these states including Philladelphia, the capital city of Pennsylvania:</td>
</tr>
<tr class="even">
<td>::: {.cell execution_count=19}</td>
</tr>
<tr class="odd">
<td>::: {.cell-output .cell-output-display execution_count=19}</td>
</tr>
<tr class="even">
<td><code>{=html} &lt;script type="application/vnd.jupyter.widget-view+json"&gt; {"model_id":"4e1431195538443db107698312564f13","version_major":2,"version_minor":0} &lt;/script&gt;</code></td>
</tr>
<tr class="odd">
<td>::: :::</td>
</tr>
<tr class="even">
<td>On the left side of the river is Philladelphia, PA, while on the right side is Camden, NJ. The code below uses the county shapefile we used before to isolate the counties in NJ and PA that are on the border.</td>
</tr>
<tr class="odd">
<td>::: {.cell execution_count=20} ``` {.python .cell-code} import geopandas as gpd</td>
</tr>
<tr class="even">
<td>shp = gpd.read_file(‘data/wk10/geojson-counties-fips.json’) # read in the counties shapefile</td>
</tr>
<tr class="odd">
<td>subset=shp[shp[‘STATE’].isin([‘34’,‘42’])] # new jersey = 34, pennsylvania = 42, new york = 36</td>
</tr>
<tr class="even">
<td>subset[‘neighbors’]= 0 # create a new column called neighbors</td>
</tr>
<tr class="odd">
<td>for index, row in subset.iterrows(): # iterate through each row in the counties shapefile buffered= row[‘geometry’].buffer(0.1) # create a buffer around the county so that it overlaps with its neighbors neighbors = list(set(subset[subset.geometry.overlaps(buffered)].STATE.tolist()).difference([row.STATE])) # check which counties overlap with the buffer, grab the state code, and remove the current county’s state code subset.at[index, “neighbors”] = “,”.join(neighbors) # add the list of neighbors to the neighbors column</td>
</tr>
<tr class="even">
<td>subset[‘border’]=np.where(subset[‘neighbors’]==’’,0,1) # create a new column called border that is 1 if the county is on the border and 0 if it is not</td>
</tr>
<tr class="odd">
<td>subset[‘viscol’]=subset[‘STATE’].astype(int)+subset[‘border’] # create a new column that combines the state code and the border column subset.plot(column=‘viscol’,legend=False, figsize=(20,10), cmap=‘RdYlGn’) # plot the counties and color them by the border column plt.title(‘Border Counties in New Jersey and Pennsylvania’, fontsize=20) # add a title ```</td>
</tr>
<tr class="even">
<td>::: {.cell-output .cell-output-display execution_count=20}</td>
</tr>
<tr class="odd">
<td>::: {.cell-output .cell-output-display} <img src="W10. Causal Inference_files/figure-html/cell-19-output-2.png" class="img-fluid"> ::: :::</td>
</tr>
<tr class="even">
<td>The plot above shows counties in Pennsylvania in green, and New Jersey in red. Dark green counties are border counties in PA, while light red counties are border counties in NJ. Under the assumption that these counties are going to be very similar to each other in most ways other than the fact that NJ implemented a minimum wage law, the simplest regression discontinuity desgin would basically just be a regression of the following form:</td>
</tr>
<tr class="odd">
<td>::: {.cell execution_count=30} ``` {.python .cell-code} border_counties=subset[subset[‘border’]==1][‘id’].tolist() # create a list of the border counties rdd=counties[(counties[‘year’]&gt;2007)&amp;(counties[‘county_fips’].isin(border_counties))] # subset the counties data to only include border counties and years after 2007 rdd_model = ols(‘unemployment ~ C(state)’, rdd[rdd[‘year’]&gt;2014]).fit() print(rdd_model.summary())</td>
</tr>
<tr class="even">
<td>```</td>
</tr>
<tr class="odd">
<td>::: {.cell-output .cell-output-stdout} ``` OLS Regression Results ============================================================================== Dep. Variable: unemployment R-squared: 0.047 Model: OLS Adj. R-squared: 0.038 Method: Least Squares F-statistic: 5.078 Date: Mon, 19 Dec 2022 Prob (F-statistic): 0.0264 Time: 09:26:14 Log-Likelihood: -213.30 No.&nbsp;Observations: 105 AIC: 430.6 Df Residuals: 103 BIC: 435.9 Df Model: 1 Covariance Type: nonrobust ================================================================================== coef std err t P&gt;|t| [0.025 0.975]</td>
</tr>
</tbody>
</table>
<p>Intercept 5.2054 0.249 20.910 0.000 4.712 5.699 C(state)[T.42] 0.8212 0.364 2.253 0.026 0.098 1.544 ============================================================================== Omnibus: 22.707 Durbin-Watson: 0.642 Prob(Omnibus): 0.000 Jarque-Bera (JB): 29.073 Skew: 1.166 Prob(JB): 4.86e-07 Kurtosis: 4.100 Cond. No.&nbsp;2.55 ==============================================================================</p>
<p>Notes: [1] Standard Errors assume that the covariance matrix of the errors is correctly specified. ``` ::: :::</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../notebooks/W09. Linear Regression.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Linear Regression</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->



</body></html>